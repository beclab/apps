---
olaresManifest.version: '0.10.0'
olaresManifest.type: app
apiVersion: 'v2'
metadata:
  name: whisperservicev2
  description: FastAPI service on top of WhisperX
  icon: https://app.cdn.olares.com/appstore/whisperwebui/icon.png
  appid: whisperservicev2
  version: '1.0.2'
  title: Whisper API
  categories:
  - AI
  - Utilities_v112
  - Utilities
sharedEntrances:
- name: whisperservicev2
  title: Whisper API
  host: sharedentrances-api
  icon: https://app.cdn.olares.com/appstore/whisperwebui/icon.png
  port: 0
  invisible: true
  authLevel: internal
entrances:
  - name: whisperservicev2
    port: 8080
    host: whisperapi-web-svc
    title: Whisper API
    icon: https://app.cdn.olares.com/appstore/whisperwebui/icon.png
    authLevel: internal
    openMethod: window
permission:
  appData: true
  appCache: true
  userData:
    - Home
spec:
  versionName: '1.1.0'
  fullDescription: |
    The whisperX API is a tool for enhancing and analyzing audio content. This API provides a suite of services for processing audio and video files, including transcription, alignment, diarization, and combining transcript with diarization results.

    Available Services
    # Speech-to-Text (/speech-to-text)
    - Upload audio/video files for transcription
    - Supports multiple languages and Whisper models

    # Speech-to-Text URL (/speech-to-text-url)
    - Transcribe audio/video from URLs
    - Same features as direct upload

    # Individual Services:
    - Transcribe (/service/transcribe): Convert speech to text
    - Align (/service/align): Align transcript with audio
    - Diarize (/service/diarize): Speaker diarization
    - Combine (/service/combine): Merge transcript with diarization

    Task Management:
    - Get all tasks (/task/all)
    - Get task status (/task/{identifier})

    Health Check Endpoints:
    - Basic health check (/health): Simple service status check
    - Liveness probe (/health/live): Verifies if application is running
    - Readiness probe (/health/ready): Checks if application is ready to accept requests (includes database connectivity check)    
  developer: pavelzbornik
  website: https://github.com/pavelzbornik/whisperX-FastAPI
  sourceCode: https://github.com/pavelzbornik/whisperX-FastAPI
  submitter: Olares
  locale:
    - en-US
    - zh-CN
  doc: https://github.com/pavelzbornik/whisperX-FastAPI
  license:
    - text: MIT License
      url: https://github.com/pavelzbornik/whisperX-FastAPI?tab=MIT-1-ov-file

  {{- if and .Values.admin .Values.bfl.username (eq .Values.admin .Values.bfl.username) }}
  requiredMemory: 3Gi
  limitedMemory: 20Gi
  requiredDisk: 12Gi
  limitedDisk: 20Gi
  requiredCpu: 1
  limitedCpu: 5
  requiredGpu: 5Gi
  limitedGpu: 16Gi
  {{- else }}
  requiredMemory: 64Mi
  limitedMemory: 500Mi
  requiredDisk: 50Mi
  limitedDisk: 200Mi
  requiredCpu: 10m
  limitedCpu: 500m
  {{- end }}
  supportArch:
    - amd64
    - arm64
  subCharts:
  - name: whisperservicev2server
    shared: true
  - name: whisperservicev2
options:
  apiTimeout: 0
  dependencies:
    - name: olares
      type: system
      version: '>=1.12.3-0'
  {{- if and .Values.admin .Values.bfl.username (eq .Values.admin .Values.bfl.username) }}
  {{- else }}
    - name: whisperservicev2
      type: application
      version: '>=1.0.0'
      mandatory: true
  {{- end }}
  appScope:
  {{- if and .Values.admin .Values.bfl.username (eq .Values.admin .Values.bfl.username) }}
    clusterScoped: true
    appRef:
      - whisperservicev2
  {{- else }}
    clusterScoped: false
  {{- end }}
envs:
{{- if and .Values.admin .Values.bfl.username (eq .Values.admin .Values.bfl.username) }}
  - envName: HF_TOKEN
    required: true
    applyOnChange: true
    valueFrom:
      envName: OLARES_USER_HUGGINGFACE_TOKEN
{{- end }}
  - envName: HF_ENDPOINT
    required: true
    applyOnChange: true
    valueFrom:
      envName: OLARES_USER_HUGGINGFACE_SERVICE
