metadata:
  description: 全球最先进的数据库 DevOps 和 CI/CD 工具，适用于开发人员、DBA 和平台工程团队。
  title: Bytebase
spec:
  fullDescription: |
    Bytebase 是一款开源数据库 DevOps 工具，相当于数据库管理领域的 GitLab/GitHub，覆盖应用开发全生命周期。提供面向 DBA、开发人员和平台工程师的基于 Web 的协作工作空间。

    ## 亮点 ##
    不同的数据库开发任务
    多种数据库系统
    统一流程
    单一工具

    ## 主要功能 ##
    * SQL 审查
      Bytebase 分析 SQL 变更，以符合组织策略执行规则。执行内容包括命名规范、反 SQL 模式检测等。生产和非生产环境也可以分别执行不同规则。
    * 数据库 CI/CD 和变更自动化
      类似代码审查，Bytebase 简化了数据库变更过程。在单一工作流中，可以从开发环境一直审查并部署到生产环境。
    * GitOps（数据库即代码）
      Bytebase 保留完整的模式变更历史记录。它还与 VCS 系统集成。团队可以在 VCS 中管理 SQL 迁移脚本，并在代码提交时触发模式部署。
    * 批量变更和查询
      Bytebase 允许您在单一工作流中变更一系列数据库。它还允许您对多个数据库发出单一查询。
    * SQL 编辑器
      一个基于 Web 的 SQL 编辑器，用于查询和导出数据。DBA 无需在开发人员需要访问数据时提供敏感数据库凭证。
    * 动态数据掩码
      Bytebase 提供带工作流的多级掩码策略，以授予未掩码数据访问权限。
    * 数据访问控制
      Bytebase 提供一套功能，使组织能够执行数据安全策略，避免数据泄露并符合合规性。
    * 数据回滚和灾难恢复
      - 语句级回滚
      - 数据库级手动和定期备份与恢复
      - 时间点恢复 (PITR)
  upgradeDescription: |
    升级应用版本至 3.11.0 

    重要变更：
    * 环境部署策略更新
    - 问题创建者和最后问题审批者不能再部署问题。手动部署现在需要指定工作区/项目角色或具有 bb.taskRuns.create 权限的用户。
    - 强制部署机制已替换为可配置的部署要求：
      - 需要问题审批 – 确保问题必须先审批才能继续部署（默认启用）。
      - 计划检查强制执行 – 根据计划检查结果控制部署行为（默认仅在错误时阻止）。
    
    * 弃用 bb.sql.export 权限和项目导出者角色。
    
    * 弃用项目 IAM 策略中的 request.row_limit。使用 QueryDataPolicy 中的 maximum_result_rows 代替。
    
    * API
    - 标准化 CEL 属性命名前缀：resource.*、statement.*、request.*（例如，environment_id → resource.environment_id）
    - 统一风险级别为单一 RiskLevel 枚举；从整数（100、200、300）更改为字符串（LOW、MODERATE、HIGH）；CEL 表达式从 level == 300 迁移到 level == "HIGH"
    - 简化审批模板为单例，使用扁平角色数组；替换 approval_finding_done/approval_finding_error 为 approval_status 枚举
    - 合并任务类型为 DATABASE_MIGRATE（带有 migrate_type: DDL/DML/GHOST）和 DATABASE_SDL。拆分 changelog Type 为 Type 和 MigrationType 枚举。合并 DatabaseSchemaUpdate 和 DatabaseDataUpdate 为 DatabaseUpdate。
    
    * Terraform（提供程序版本：3.11.1）
    - 使用 RiskLevel 枚举代替数字值作为 level 在 bytebase_risk 中的示例：risk.tf
    - 删除 disable_copy_data_policy；移动到 query_data_policy 作为 disable_copy_data 字段。示例：environment.tf
    - 更新 approval_flow 设置的结构。示例：approval_flow.tf
    - 从 bytebase_iam_policy 设置中删除 row_limit。
    
    * 从 SQL 编辑器中删除“格式保存”功能。

    增强功能：
    * 支持键值实例标签。
    * 优化 Schema 编辑器性能。
    * 添加预飞行验证和断路器到 gh-ost 工作流。
    * AWS Elasticsearch – 添加跨账户支持。

    错误修复

    查看完整发布说明：https://github.com/bytebase/bytebase/releases/tag/3.11.0
