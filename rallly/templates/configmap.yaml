{{- $ralllyDomainENV := split "," .Values.domain.rallly -}}
{{- $ralllyDomain := index $ralllyDomainENV "_0" -}}
{{- $localDomain := $ralllyDomain -}}

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: rallly-config
  namespace: {{ .Release.Namespace }}
data:
  # A random 32-character secret key used to encrypt user sessions
  SECRET_PASSWORD: "abcdef1234567890abcdef1234567890"

  # The base url where this instance is accessible, including the scheme.
  # Example: https://example.com
  NEXT_PUBLIC_BASE_URL: "https://{{ $ralllyDomain }}"

  # AUTH_URL should be the same as NEXT_PUBLIC_BASE_URL
  AUTH_URL: "https://{{ $ralllyDomain }}"

  # A connection string to your Postgres database
  DATABASE_URL: "postgresql://{{ .Values.postgres.username }}:{{ .Values.postgres.password }}@{{ .Values.postgres.host }}:{{ .Values.postgres.port }}/{{ .Values.postgres.databases.rallly }}"

  # A connection string to your Postgres database for direct access (used for migrations)
  DIRECT_DATABASE_URL: "postgresql://{{ .Values.postgres.username }}:{{ .Values.postgres.password }}@{{ .Values.postgres.host }}:{{ .Values.postgres.port }}/{{ .Values.postgres.databases.rallly }}"

  # Toggle Self-Hosted mode
  NEXT_PUBLIC_SELF_HOSTED: "false"

  # Suppress warning from sentry during local development
  SENTRY_IGNORE_API_RESOLUTION_ERROR: "1"

  # Required to be able to send emails
  SUPPORT_EMAIL: "your_smtp_email@test.com"
  # Mailhog SMTP settings
  SMTP_HOST: ""
  SMTP_PORT: "465"
  SMTP_SECURE: "true"
  SMTP_USER: "your_smtp_email@test.com"
  SMTP_PWD: ""
