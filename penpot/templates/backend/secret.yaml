{{- $existing := (lookup "v1" "Secret" .Release.Namespace "penpot-secret") -}}
{{- $secret_value := "" -}}
{{- if $existing }}
  {{- $secret_value = index $existing.data "penpot-secret" -}}
{{- else }}
  {{- $secret_value = (randAlphaNum 32 | b64enc) -}}
{{- end }}

---
apiVersion: v1
kind: Secret
metadata:
  name: penpot-secret
  namespace: {{ .Release.Namespace }}
type: Opaque
data:
  penpot-secret: {{ $secret_value }}
